# Machine Learning vs. Economic Restrictions: Evidence from Stock Return Predictability

## Abstract

This paper shows that investments based on deep learning signals extract profitability from difficult-to-arbitrage stocks and during high limits-to-arbitrage market states. In particular, excluding microcaps, distressed stocks, or episodes of high market volatility considerably attenuates profitability.Machine learning-based performance further deteriorates in the presence of reasonable trading costs because of high turnover and extreme positions in the tangency portfolio implied by the pricing kernel. Despite their opaque nature, machine learning methods successfully identify mispriced stocks consistent with most anomalies. Beyond economic restrictions, deep learning signals are profitable in long positions and recent years and command low downside risk.

本研究表明，基于深度学习信号的投资策略能够从难以套利的股票和套利限制较高的市场状态中获取收益。具体而言，若排除微市值股票、困境股或市场高波动时期，其盈利能力将显著减弱。在考虑合理交易成本的情况下，由于切线投资组合隐含的定价核导致的高换手率和极端头寸，基于机器学习的策略表现进一步恶化。尽管存在不透明性，机器学习方法仍能有效识别与多数市场异象相一致的错误定价股票。除经济约束外，深度学习信号在多头头寸和近年市场中展现出盈利能力，并具有较低的下行风险。

## 1. Introduction

Financial economists have uncovered a plethora of firm characteristics that predict stock returns in the cross-section. However, recent work has challenged the credibility of the evidence on stock return predictability. Harvey et al. (2016) examine 296 published significant factors and conclude that 80 to 158 of them are likely to be false discoveries. Hou et al. (2020) further show that 82% of 452 anomalies become statistically insignificant after excluding microcap stocks and when using value-weighted returns. There is also mounting evidence that anomalies tend to concentrate in distressed stocks and extract most of their profitability from short positions.1 Notably, it is increasingly difficult to exploit anomalies in recent years because of increased market liquidity and arbitrage activity.

金融经济学家们已经发现了大量能够在横截面数据中预测股票收益的公司特征。然而，最近的研究对股票收益可预测性方面证据的可信度提出了质疑。哈维等人（2016 年）研究了 296 个已发表的重要因子，得出结论称其中 80 到 158 个因子很可能是错误的发现。侯等人（2020 年）进一步表明，在排除微型股并使用市值加权收益率的情况下，452 个价格异常情况中有 82% 在统计上不再显著。也有越来越多的证据表明，价格异常情况往往集中在困境股中，并且其大部分盈利是通过卖空持仓获得的。值得注意的是，由于市场流动性增强和套利活动增加，近年来利用价格异常情况获利变得越来越困难。

Counter to this “anomaly challenging” strand of literature, there has been an emerging body of work that reports phenomenal investment profitability based on signals generated by machine learningmethods.2 Applying machine learning routines to financial data has been implicitly motivated by the American Finance Association (AFA) presidential address of Cochrane (2011), who suggests that in the presence of a vast collection of noisy and highly correlated return predictors, there is a need for other methods beyond cross-sectional regressions and portfolio sorts. Indeed, machine learning offers a natural way to accommodate a high-dimensional predictor set and flexible functional forms, and it uses “regularization” methods to select models, mitigate overfitting biases, and uncover complex patterns and hidden relationships.

与这种“挑战异常”的文献流相反，近年来出现了一批报告基于机器学习方法生成的信号具有非凡投资盈利能力的研究成果。将机器学习例程应用于财务数据的做法，在某种程度上受到了美国金融协会（AFA）主席Cochrane在2011年演讲的隐含启发，Cochrane指出，在面对大量嘈杂且高度相关的收益预测指标时，除了横截面回归和投资组合分类之外，还需要其他方法。实际上，机器学习提供了一种自然的方式以适应高维预测变量集和灵活的功能形式，并且它使用“正则化”方法来选择模型、减轻过拟合偏差并揭示复杂的模式和隐藏的关系。

A close look at these two strands of literature, namely, diminishing individual anomalies in contrast to the outstanding profitability of machine learning signals that aggregate multiple anomalies, suggests that our understanding of the economic significance of machine learning signals is inconclusive. Although vast evidence shows that individual anomalies concentrate in difficultto- arbitrage stocks and high limits-to-arbitrage market episodes, machine learning methods could indicate a promising direction to identify mispricing when trading frictions attenuate because of their advanced mechanism of aggregating individual anomalies. Thus, a priori, it is impossible to make clear inferences about the economic significance of machine learning signals based on the knowledge we have gained from individual anomalies.

仔细审视这两类文献，一方面是单个价格异常情况的获利能力在减弱，另一方面是聚合了多个价格异常情况的机器学习信号却有着出色的盈利能力，这表明我们对于机器学习信号的经济意义的理解尚无定论。尽管大量证据表明，单个价格异常情况集中出现在难以套利的股票以及套利限制较高的市场时期，但机器学习方法或许指明了一个充满希望的方向，即当交易摩擦因这些方法聚合单个价格异常情况的先进机制而减少时，它们能够识别出定价错误。因此，从先验的角度来看，基于我们从单个价格异常情况中所获得的知识，是无法对机器学习信号的经济意义做出清晰推断的。

This paper aims to fill this gap by comprehensively examining whether investors can harvest extra profits generated by various machine learning signals that are detailed in the following paragraph. To do so, we first impose several economic restrictions. In the cross-section, we limit the universe of stocks to those that are relatively cheap to trade by excluding microcaps or distressed firms. In the time series, we examine whether investment profitability is more pronounced during high limits-to-arbitrage market states, such as high volatility and low liquidity. We then assess the turnover and the corresponding transaction costs associated with implementing machine learning-based investments and finally explore the economic foundations of trading strategies advocated by seemingly opaque machine learning methods.

本文旨在通过全面检验投资者是否能够获取下文详述的各种机器学习信号所产生的超额利润，从而填补这一研究空白。为此，我们首先设定了若干经济约束条件：在横截面维度，通过剔除微型股或困境企业，将投资标的限定于交易成本相对较低的股票；在时间序列维度，重点考察投资盈利能力是否在套利限制较高的市场状态下（如高波动性和低流动性时期）更为显著。继而，我们评估了实施基于机器学习的投资策略所涉及的换手率及相应交易成本，最终揭示了那些表面看似不透明的机器学习方法所倡导的交易策略背后的经济学基础。

We consider a comprehensive set of linear and nonlinear models, study both spread (long-minus-short) and tangency portfolios, and account for both the stochastic discount factor (SDF) and beta pricing formulations. 3 We first implement a neural network with three hidden layers (NN3) as in Gu et al. (2020) (GKX) and then follow Chen et al. (2020) (CPZ) to incorporate a no-arbitrage condition into multiple connected neural networks, including feed-forward networks (FFNs), recurrent neural networks (RNNs) with long short-term memory (LSTM) cells, and a generative adversarial network (GAN). We then analyze two conditional beta pricing models in the machine learning universe, namely, instrumented principal component analysis (IPCA) per Kelly et al. (2019) (KPS) and the conditional autoencoder (CA) extension by Gu et al. (2021).

本研究采用了一套涵盖线性与非线性模型的综合分析框架，同时考察了价差组合（多空对冲组合）与切线组合（风险调整最优组合），并兼顾随机贴现因子（SDF）与贝塔定价模型的双重视角。具体而言，我们首先参照Gu et al. (2020)（简称GKX）的方法，构建了一个包含三个隐藏层的神经网络（NN3）；继而遵循Chen et al. (2020)（简称CPZ）的研究路径，将无套利约束条件嵌入到多层级联神经网络中，包括前馈神经网络（FFN）、带有长短期记忆单元（LSTM）的循环神经网络（RNN）以及生成对抗网络（GAN）。此外，我们在机器学习框架下解析了两种条件贝塔定价模型：其一是Kelly et al. (2019)（简称KPS）提出的工具化主成分分析（IPCA），其二是Gu et al. (2021)发展的条件自编码器（CA）扩展模型。

All these machine learning methods may differ in sample coverage, input variables, and optimization objectives; hence, we do not aim to identify the best method for trading purposes or conduct a rigorous comparison across the models. Instead, we examine whether the machine learning-based investment payoff could still extend to economic significance in the presence of plausible restrictions on the investment universe. The empirical experiments are based on a large sample of U.S. stocks from 1987 to 2017. The analysis proceeds as follows. To set the stage, we replicate the results reported in the original papers. The value-weighted long-short portfolio return across all stocks is 1.56% (2.18%, 0.95%, 1.16%) per month based on the GKX (CPZ, IPCA, CA) signal, and the corresponding Fama-French six-factor (FF6)-adjusted return is 0.92% (1.87%, 0.62%, 0.75%). Such large and significant figures reflect the impressive success of machine learning techniques in generating outstanding performance relative to traditional methods such as nonregulated regressions and portfolio sorts based on individual anomalies.

本研究涉及的各类机器学习方法在样本覆盖范围、输入变量及优化目标方面存在显著差异，故本文并不旨在甄选最优交易模型或进行严格的模型间比较，而是重点探究：在施加合理的投资域约束条件下，基于机器学习的投资策略所获收益是否仍具有经济学意义上的显著性。实证分析基于1987年至2017年间美国股市的大规模样本数据展开，具体分析步骤如下：首先，我们对原始文献的核心结论进行复现。根据GKX（CPZ、IPCA、CA）模型生成的信号构建全样本市值加权的多空组合，其月均收益率达1.56%（2.18%、0.95%、1.16%），经Fama-French六因子模型（FF6）调整后的收益率分别为0.92%（1.87%、0.62%、0.75%）。这些显著的超额收益数据凸显了机器学习技术在投资绩效生成方面的突破性优势——相较于传统的非正则化回归方法和基于单一异象因子构建投资组合的范式，机器学习展现出革命性的性能提升。

Imposing economic restrictions reveals that the predictability of deep learning methods (i.e., GKX, CPZ, and CA) weakens considerably. Relative to the full sample evidence across all stocks, the value-weighted FF6-adjusted return based on the GKX (CPZ, CA) signal is 66% (71%, 48%) lower after excluding microcaps, 53% (77%, 75%) lower after excluding firms that do not have credit rating coverage, and 78% (69%, 94%) lower after excluding financially distressed firms that face further deteriorating credit conditions. None of the deep learning methods generates significant value-weighted FF6-adjusted returns at the 5% level after excluding distressed firms. For perspective, we apply the same economic restrictions to traditionalmethods and find a similar proportional magnitude of performance deterioration. Although IPCA underperforms deep learning models for the full sample, its performance only deteriorates modestly for subsamples that consist of cheap-to-trade stocks. Unlike deep learning models that facilitate nonlinearities, IPCA draws on the linear dependence between stock returns and firm characteristics. The evidence is thus consistent with the concept that accounting for nonlinearities is especially useful for difficult-to-value and difficult-toarbitrage stocks.

施加经济限制后发现，深度学习方法（即GKX、CPZ和CA）的预测能力显著减弱。相对于所有股票全样本中的证据，基于GKX（CPZ，CA）信号的价值加权FF6调整回报在排除微型股后分别降低了66%（71%，48%），在排除没有信用评级覆盖的公司后分别降低了53%（77%，75%），而在排除面临信贷条件进一步恶化的财务困境公司后分别降低了78%（69%，94%）。排除困境公司后，没有任何深度学习方法能在5%的水平上产生显著的价值加权FF6调整回报。作为对比，我们对传统方法施加相同的经济限制，发现其业绩下降的比例幅度相似。尽管IPCA在全样本上的表现不如深度学习模型，但在由易于交易的股票组成的子样本中，其性能仅轻微恶化。不同于促进非线性的深度学习模型，IPCA依赖于股票收益与公司特征之间的线性关系。因此，这一证据与考虑非线性对于难以估值和难以套利的股票特别有用的观念是一致的。

Our findings are robust to alternative ways to implement neural networks, such as imposing economic restrictions on the training and validation samples (rather than using the entire universe of stocks), considering an alternative loss function that value weights (rather than equal weights) forecast errors, and predicting risk-adjusted (rather than raw) returns.

我们的研究结果对于实施神经网络的其他方式而言具有稳健性，比如对训练样本和验证样本施加经济限制（而非使用全部的股票样本），考虑采用一种以市值加权（而非等权重）预测误差的替代损失函数，以及预测经风险调整后的（而非原始的）收益率。

We then show that all four machine learning signals generate portfolio turnover that is considerably higher than most individual anomalies. The monthly turnover in the long-short portfolio is at least 87% (163%, 113%, 148%) for the GKX (CPZ, IPCA, CA) method, respectively. Altogether, in the presence of reasonable trading costs, the machine learning-based investments that we analyze would struggle to achieve a statistically and economically meaningful risk-adjusted payoff.

然后我们表明，所有这四种机器学习信号所产生的投资组合换手率都大大高于大多数单个价格异常情况。对于 GKX（CPZ、IPCA、CA）方法而言，多空投资组合的月换手率分别至少为 87%（163%、113%、148%）。总体而言，在存在合理交易成本的情况下，我们所分析的基于机器学习的投资将难以实现具有统计和经济意义的经风险调整后的收益。

The previously described findings are further confirmed in an investment universe consisting of equity portfolios rather than individual stocks. In particular, we use the approach of Kozak et al. (2020) (KNS) to estimate the SDF. Because the SDF slope coefficients correspond to weights of the mean-variance efficient (MVE) portfolio (Hansen and Jagannathan 1991) and the MVE portfolio tends to take extreme stock positions associated with poor estimates of mean returns and the covariance matrix (Merton 1980, Green and Hollifield 1992), we examine the implications of economic restrictions on the SDF-implied MVE portfolio in terms of performance and portfolio weights. We find that the performance of the SDF-implied portfolio also deteriorates in subsamples with economic restrictions. Moreover, conditional on a predetermined level of market volatility, the SDF is estimated based on rather extreme portfolio positions. For instance, the SDF implies a −234% (−91%) short position in an individual anomaly portfolio at the 5th (25th) percentile and a 190% (96%) long position at the 95th (75th) percentile. Thus, the pricing kernel might be inadmissible from a real-time investment perspective. Restricting the investment universe to relatively cheap-to-trade stocks considerably mitigates equity positions.

上述发现，在一个由股票投资组合而非单只股票构成的投资领域中，得到了进一步证实。具体而言，我们采用了科扎克等人（2020 年）（KNS）的方法来估计随机折现因子（SDF）。由于随机折现因子的斜率系数与均值 - 方差有效（MVE）投资组合的权重相对应（汉森和贾甘纳坦，1991 年），并且均值 - 方差有效投资组合往往会持有与预期平均收益率以及协方差矩阵的不准确估计相关的极端股票头寸（默顿，1980 年；格林和霍利菲尔德，1992 年），所以我们从投资表现和投资组合权重方面，研究了对随机折现因子所隐含的均值 - 方差有效投资组合施加经济限制所产生的影响。我们发现，在施加经济限制的子样本中，随机折现因子所隐含的投资组合的表现也会变差。此外，在市场波动处于预定水平的条件下，随机折现因子是基于相当极端的投资组合头寸来估计的。例如，随机折现因子意味着，在处于第 5（25）百分位数的单个价格异常投资组合中，会有 - 234%（-91%）的空头头寸，而在处于第 95（75）百分位数的投资组合中，会有 190%（96%）的多头头寸。因此，从实时投资的角度来看，定价内核可能并不适用。将投资范围限制在交易成本相对较低的股票上，可大幅减轻股票头寸的压力。

We next examine whether and how machine learningbased performance varies with market conditions. Economic theory implies that fewer trading frictions and more arbitrage activity should improve price efficiency.4 Consistent with the economic notion of limits to arbitrage, we demonstrate that the investment strategy based on GKX and CPZ signals (across all stocks) is considerably more profitable during periods of high investor sentiment, high market volatility, and low market liquidity. For instance, the monthly value-weighted FF6-adjusted return based on the GKX signal is statistically insignificant at 0.22% at times of low VIX and increases dramatically to 1.66% at times of high VIX, whereas the full sample average is 0.92%. In contrast, IPCA and CA models display relatively modest time series variation in trading profits and could even outperform in low limits-to-arbitrage market states.

We also examine the most recent years and find that unlike traditional anomaly-based trading strategies, all four machine learning signals continue to predict cross-sectional stock returns in the post-2001 period across all stocks. This finding supports the concept that machine learning techniques combine multiple weak sources of information into a meaningful composite signal. Consistent with our main results, anomalous return patterns in recent years are also confined to difficult-to-arbitrage stocks.

As emphasized by Karolyi and Van Nieuwerburgh (2020), it is imperative to examine the economic foundations of seemingly opaque machine learning methods. We propose two experiments to gauge the economic foundations. We first examine whether stocks with similar machine learning signals share common characteristics that are known to predict returns. The evidence shows that all four machine learning methods successfully identify mispriced stocks consistent with most anomaly-based trading strategies. Stocks in the long positions of machine learning-based investments are typically small, value, illiquid, and old stocks with a low price, low beta, high 11-month return (medium-term winners), low asset growth, low equity issuance, low credit rating coverage, and low analyst coverage. Therefore, despite their opaque nature, machine learning signals successfully identify mispriced stocks consistent with well-established empirical facts, without preselection of truly useful characteristics and models. Our findings highlight the merits of employing machine learning methods to avoid the data snooping problem in the anomaly literature and suggest that blackbox- like machine learning models are reasonably interpretable, which is essential for a robust and credible assessment of out-of-sample predictability.

Second, we control for the industry benchmark in machine learning signals and decompose the unconditional payoff into two components: intra-industry and interindustry payoffs. Taking the GKX signal as an example, we construct three trading strategies based on NN3- predicted returns for all investable stocks (beyond the extreme long and short portfolios), including (1) an unconditional strategy that takes long (short) positions on market winners (market losers); (2) an intra-industry strategy that takes long (short) positions on industry winners (industry losers); and (3) an inter-industry strategy that takes long (short) positions on winner industries (loser industries). We show that the intra-industry strategy outperforms the unconditional strategy and the inter-industry strategy, suggesting that GKX signal is more informative for stock selection than for industry rotation. Our findings are robust to similar return decompositions based on IPCA and CA signals. Consistent with the finding that machine learning signals identify mispricing in difficult-to-arbitrage stocks, adjusting for industry averages further controls for similar firm fundamentals within the same industry and thus better predicts subsequent corrections due to market frictions.

With the recent development of financial technology (Fintech), using machine learning tools to identify new signals on price movements and to develop investment systems that can outperform human fund managers is gaining popularity (FSB 2017).6 Our findings further support the concept that machine learning-based investments could hold considerable promise for asset management. First, we find that they can mitigate the downside risk and provide a good hedge during market crises. For instance, for major episodes of market downturns (e.g., the 1987 market crash, the Russian default, the bursting of the tech bubble, and the recent financial crisis), the GKX (CPZ, IPCA, CA) method generates, on average, a monthly value-weighted return of 3.56% (0.68%, 1.49%, −0.53%) after excluding microcaps, respectively. For perspective, the contemporaneous market excess return is −6.91%. Second, although the profitability of individual anomalies is driven primarily by short positions and often disappears in recent years, machine learning signals yield considerable profit in the long positions and remain viable in the post-2001 period. The performance of machine learning signals could further improve on industry adjustment.

To conclude, our paper is the first to provide largescale evidence on the economic significance of machine learning methods. The machine learning (especially deep learning) techniques that we analyze face many of the challenges regarding cross-sectional return predictability. In particular, anomalous return patterns characterize difficult-to-value and difficult-to-arbitrage stocks. In addition, to the extent that deep learning signals predict cross-sectional stock returns for the full sample, the trading strategy is more profitable during periods of high market volatility and low market liquidity. Machine learning signals also involve remarkably high turnover and often require taking extreme long-short positions in the tangency portfolio implied by the pricing kernel. Beyond economic restrictions, machine learning-based trading strategies nonetheless display less downside risk, yield considerable profit in long positions, and remain viable in the post-2001 period and the crisis period. Finally, black-box-like machine learning methods still generate economically interpretable trading strategies and are more meaningful for stock selection than for industry rotation.

Our analysis initiates a protocol for future work to demonstrate the feasibility of trading profits, such as (1) constructing value-weighted portfolios after excluding difficult-to-arbitrage stocks, (2) considering portfolio turnover and the corresponding transaction costs, (3) ensuring that the proposed tangency portfolio mitigates extreme long-short positions, (4) excluding high limits-to-arbitrage market states, (5) emphasizing performance over recent years, and (6) focusing on long positions.

Some recent studies have already responded to our findings and considered these economic hurdles when advocating new machine learning tools. These studies indicate the potential promise of understanding the cross-section of equity returns through the lens of deep learning and artificial intelligence (AI). For instance, CPZ continue to find a high annual Sharpe ratio of the SDF portfolio at 1.73 after removing 40% of the smallest stocks. Cong et al. (2021) use reinforcement learning to directly construct an AlphaPortfolio that maximizes the out-of-sample Sharpe ratio. The AlphaPortfolio is robust to imposing various economic restrictions in both the cross-section and time series as we propose; hence, it could be a competent and implementable approach for practitioners and advance our understanding of cross-sectional return predictability.

Taken together, our paper enriches the academic and policy discussions surrounding the adoption of machine learning techniques in asset management, including the effectiveness and sustainability of new trading signals, the lack of transparency and economic interpretability in complex machine learning algorithms, and the potential regulatory and supervisory implications related to financial stability.

综上所述，我们的论文丰富了围绕在资产管理领域采用机器学习技术所展开的学术和政策讨论，这些讨论涵盖了新交易信号的有效性和可持续性、复杂机器学习算法中透明度和经济可解释性的缺失，以及与金融稳定相关的潜在监管和监督影响等方面。

The rest of the paper is organized as follows. Section 2 describes the methodology and data. Section 3 presents evidence on return predictability and other characteristics of machine learning portfolios for the full sample and subsamples with economic restrictions. Section 4 studies the time-varying return predictability of machine learning methods. Section 5 investigates the economic foundation for machine learning methods. Section 6 concludes.
